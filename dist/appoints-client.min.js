!function(o){try{o=angular.module("appoints-client-templates")}catch(e){o=angular.module("appoints-client-templates",[])}o.run(["$templateCache",function(o){o.put("home/home.html","<h2>Appointment scheduler app version {{version}}</h2>")}])}(),function(o){try{o=angular.module("appoints-client-templates")}catch(e){o=angular.module("appoints-client-templates",[])}o.run(["$templateCache",function(o){o.put("auth/login.html",'<h2>Login</h2><p>Appoints doesn\'t store user credentials such as usernames and passwords. It\'s required to use one of the providers below.</p><p><a href="" ng-click="loginFacebook()">Login with Facebook</a><br><a href="" ng-click="loginGoogle()">Login with Google</a></p>')}])}(),angular.module("appoints.config",[]).constant("config",{version:"0.1.0",defaultApiEndpoint:"http://localhost:3000"}),angular.module("appoints.flash",[]).factory("flash",["$rootScope",function(o){function e(e,n){n=n||"info";var t={message:e,level:n};a.push(t),o.$broadcast("event:flash.add",t)}function n(){return a}function t(){var o=angular.copy(a);return r(),o}function r(){o.$broadcast("event:flash.clear",!0),a=[]}var a=[];return{add:e,all:n,clear:r,allClear:t}}]),angular.module("appoints.usersession",["appoints.flash","appoints.config"]).factory("usersession",["$rootScope","$http","$window","config","flash",function(o,e,n,t,r){function a(){return angular.copy(l,this)}function i(){return c}function s(a){return n.localStorage.setItem("access_token",a),e({method:"GET",url:t.defaultApiEndpoint+"/me"}).then(function(e){c.isAuthenticated=!0,c.userId=e.data.userId,c.displayName=e.data.displayName,c.roles=e.data.roles,o.$broadcast("event:loggedin",c)},function(o){r.add(o.message,"error")})}function u(){n.localStorage.removeItem("access_token"),c=new a,o.$broadcast("event:loggedout",c)}var l={userId:"",displayName:"",isAuthenticated:!1,roles:[]},c=new a;return{current:i,login:s,logout:u}}]),angular.module("appoints.home",["appoints.config","ngRoute"]).config(["$routeProvider",function(o){o.when("/",{templateUrl:"home/home.html",controller:"HomeCtrl",title:"Home"})}]).controller("HomeCtrl",["$scope","config",function(o,e){o.version=e.version}]),angular.module("appoints.authinterceptor",["appoints.usersession"]).factory("authInterceptor",["$rootScope","$q","$window","$location","$log","$injector",function(o,e,n,t,r,a){return{request:function(o){return o.headers=o.headers||{},n.localStorage.getItem("access_token")&&(o.headers.Authorization="Bearer "+n.localStorage.getItem("access_token")),o},response:function(o){return 401===o.status&&r.warn("Response 401"),o||e.when(o)},responseError:function(o){if(401===o.status){var n=a.get("usersession");r.info("Response Error 401",o),n.logout(),t.path("/login").search("returnTo",t.path())}return e.reject(o)}}}]).config(["$httpProvider",function(o){o.interceptors.push("authInterceptor")}]),angular.module("appoints.login",["appoints.config","appoints.usersession","ngRoute"]).config(["$routeProvider",function(o){o.when("/login",{templateUrl:"auth/login.html",controller:"LoginCtrl",title:"Login"})}]).run(["$window","$rootScope","$location","config","usersession",function(o,e,n,t,r){o.addEventListener("message",function(o){o.origin===t.defaultApiEndpoint&&r.login(o.data).then(function(){e.loginPopup&&(e.loginPopup.close(),delete e.loginPopup),n.url("/")})},!1)}]).controller("LoginCtrl",["$scope","$rootScope","$window","config",function(o,e,n,t){function r(o){return e.loginPopup=n.open(o,"authenticate","width=600,height=450"),!1}o.loginFacebook=function(){return r(t.defaultApiEndpoint+"/auth/facebook")},o.loginGoogle=function(){return r(t.defaultApiEndpoint+"/auth/google")}}]),angular.module("appoints",["ngRoute","appoints.flash","appoints.usersession","appoints.authinterceptor","appoints.home","appoints.login","appoints-client-templates"]).config(["$httpProvider",function(o){o.defaults.useXDomain=!0,delete o.defaults.headers.common["X-Requested-With"]}]).controller("AppCtrl",["$scope","$location","usersession",function(o,e,n){var t="Appoints";o.pageTitle=t,o.$on("$routeChangeSuccess",function(e,n){o.pageTitle=n.title||t}),o.user=n.current(),o.routeIs=function(o){return e.path()===o},o.logout=function(){n.logout(),e.url("/")},o.$on("event:loggedin",function(e,n){o.user=n}),o.$on("event:loggedout",function(e,n){o.user=n})}]);